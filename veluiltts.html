<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veluil TTS Engine</title>
    <style>
        body { 
            background-color: #000; 
            color: #0f0; 
            font-family: 'Courier New', Courier, monospace; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            margin: 0;
        }
        .container { 
            width: 90%; 
            max-width: 650px; 
            border: 2px solid #0f0; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 0 20px #0f0; 
        }
        h2 { text-align: center; color: #0f0; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 25px;}
        textarea { 
            width: 100%; 
            height: 150px; 
            background: #111; 
            color: #fff; 
            border: 1px solid #0f0; 
            padding: 15px; 
            box-sizing: border-box; 
            font-size: 1.4rem; 
            margin-bottom: 20px; 
            border-radius: 5px; 
            outline: none; 
            resize: none;
        }
        .btn-group { display: flex; gap: 10px; width: 100%; }
        button { 
            background-color: #0f0; 
            color: #000; 
            border: none; 
            padding: 20px; 
            cursor: pointer; 
            font-weight: bold; 
            flex: 1;
            font-size: 1.5rem; 
            border-radius: 5px; 
            text-transform: uppercase; 
        }
        button:hover { background-color: #fff; box-shadow: 0 0 15px #fff; }
        #downloadBtn { background-color: #fff; color: #000; }
    </style>
</head>
<body>

<div class="container">
    <h2>Veluil TTS Engine</h2>
    <textarea id="input" placeholder="Only 'Enter' will pause"></textarea>
    <div class="btn-group">
        <button id="speakBtn">Speak</button>
        <button id="downloadBtn">Download</button>
    </div>
</div>

<script>
  alert('pls check about your browser support TTS. if you didnt input veluil text then this is not work')
    const CHO = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
    const JUNG = ['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
    const JONG = ['', 'ㄱ','ㄲ','ㄳ','ㄴ','ㄵ','ㄶ','ㄷ','ㄹ','ㄺ','ㄻ','ㄼ','ㄽ','ㄾ','ㄿ','ㅀ','ㅁ','ㅂ','ㅄ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];

    const vCons = ['ㅁ','ㅂ','ㄷ','ㄱ','ㄴ','ㄹ','ㅃ','ㄸ','ㄲ','ㅍ','ㅌ','ㅋ','ㅈ','ㅉ','ㅊ','ㅅ'];
    const vVow = [
        {v:'ㅜ', c:''}, {v:'ㅗ', c:''}, {v:'ㅓ', c:''}, {v:'ㅡ', c:''},
        {v:'ㅏ', c:''}, {v:'ㅐ', c:''}, {v:'ㅣ', c:''}, {v:'ㅝ', c:''},
        {v:'ㅜ', c:'ㅁ'}, {v:'ㅗ', c:'ㅁ'}, {v:'ㅓ', c:'ㅁ'}, {v:'ㅡ', c:'ㅁ'},
        {v:'ㅏ', c:'ㅁ'}, {v:'ㅐ', c:'ㅁ'}, {v:'ㅣ', c:'ㅁ'}, {v:'ㅙ', c:''}
    ];
    const alphabet = "abcdefghijklmnop";

    function combine(cho, jung, jong = '') {
        const cIdx = CHO.indexOf(cho);
        const jIdx = JUNG.indexOf(jung);
        const oIdx = JONG.indexOf(jong || '');
        if (cIdx === -1 || jIdx === -1) return cho + jung + (jong || '');
        return String.fromCharCode(44032 + (cIdx * 588) + (jIdx * 28) + (oIdx === -1 ? 0 : oIdx));
    }

    // [핵심] Veluil 알파벳을 한글 발음으로 변환하는 공통 함수
    function convertVeluilToKorean(text) {
        const tokens = text.toLowerCase().split('\n');
        let results = [];

        for (let token of tokens) {
            let cleanToken = token.replace(/[^a-p]/g, '');
            if (!cleanToken) continue;

            let wordResult = "";
            let chars = cleanToken.split('');
            let syllables = [];

            for (let j = 0; j < chars.length; j += 2) {
                if (!chars[j+1]) break;
                syllables.push({
                    onset: vCons[alphabet.indexOf(chars[j])],
                    vowel: vVow[alphabet.indexOf(chars[j+1])].v,
                    coda: vVow[alphabet.indexOf(chars[j+1])].c,
                    vowelChar: chars[j+1]
                });
            }

            for (let j = 0; j < syllables.length; j++) {
                let cur = syllables[j], next = syllables[j+1];
                if (cur.coda === 'ㅁ' && next && next.vowelChar === 'a') {
                    let m = {'ㄱ':'ㄱ','ㅂ':'ㅂ','ㅃ':'ㅇ','ㄷ':'ㄷ','ㄴ':'ㄴ','ㄹ':'ㄹ'}[next.onset];
                    if (m) { wordResult += combine(cur.onset, cur.vowel, m); j++; continue; }
                }
                wordResult += combine(cur.onset, cur.vowel, cur.coda);
            }
            results.push(wordResult);
        }
        return results.join('... '); // 엔터 자리에 미세한 공백
    }

    // 재생 로직
    document.getElementById('speakBtn').onclick = async () => {
        const raw = document.getElementById('input').value;
        const tokens = raw.split(/(\n)/);
        window.speechSynthesis.cancel();
        
        for (let token of tokens) {
            if (token === '\n') {
                await new Promise(r => setTimeout(r, 500));
                continue;
            }
            const kor = convertVeluilToKorean(token);
            if (kor) {
                await new Promise(res => {
                    const ut = new SpeechSynthesisUtterance(kor);
                    ut.lang = 'ko-KR';
                    ut.onend = res;
                    window.speechSynthesis.speak(ut);
                });
            }
        }
    };

    document.getElementById('downloadBtn').onclick = () => {
    const raw = document.getElementById('input').value;
    const korText = convertVeluilToKorean(raw);
    if (!korText) return;

    const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(korText)}&tl=ko&client=tw-ob`;
    
    // 새 창에서 오디오가 재생됩니다. 
    // 여기서 사용자는 마우스 우클릭 -> '다른 이름으로 저장'을 눌러 저장할 수 있습니다.
    window.open(url, '_blank');
};



</script>

</body>
</html>
